## 乐观 Rollup

你应该对[以太坊扩容方案](https://learnblockchain.cn/tags/%E6%89%A9%E5%AE%B9%E6%96%B9%E6%A1%88) 和 [Layer 2](https://learnblockchain.cn/tags/Layer2) 有所了解了。



**乐观Rollup（OP Rollup) ** 是一种 Layer2 扩展解决方案，它将计算和状态从链下转移到链下网络，并乐观的假设链下交易是有效的，仅在有争议时才进行验证。这种机制显著提高了以太坊的交易吞吐量和降低交易成本，同时保持了去中心化和高安全性。



## Op Rollup 运行机制



**1. 交易批量处理**

- **收集交易**：乐观 Rollup 收集用户提交的多笔交易，并将其批量打包。这些交易在链下进行处理，包括账户余额更新和智能合约调用等操作。
- **链下处理**：在链下，所有交易的状态变化被计算和记录，这些变化包括账户余额的更新、智能合约状态的修改等。

**2. 生成并提交批次**

- **生成交易批次**：链下操作完成后，Rollup 提交者（Sequencer）将一批交易的结果打包成一个批次，并生成批次的状态根（state root）。
- **提交到主链**：批次的状态根和交易数据或其摘要被提交到以太坊主链（Calldata 或者 blob ）。提交的数据通常包含交易的压缩形式，以减少链上的存储需求。

**3. 争议期等待挑战**

- **乐观假设**：系统假设所有提交的交易批次都是有效的，因此在没有争议的情况下，交易批次会被默认接受。这种机制显著提高了系统的效率和吞吐量。
- **欺诈证明**：如果有人发现批次中有无效交易，可以在争议期内提交欺诈证明（Fraud Proof），欺诈证明是一个具体的计算步骤，展示批次中的某个交易是无效的。它需要提供相关的计算数据和步骤，以证明提交者提交了无效交易。若欺诈验证成功后，系统会回滚无效交易，惩罚提交无效交易的Rollup 提交者，并更新状态根以反映正确的状态。





对于开发者而言，乐观Rollup的优势在于它们与[以太坊虚拟机 (EVM)](https://ethereum.org/zh/developers/docs/evm/) 的兼容性（或者更好的，等效性）。 与以太坊虚拟机兼容的Rollup符合[以太坊黄皮书](https://ethereum.github.io/yellowpaper/paper.pdf)中的规范，并在字节码级别支持以太坊虚拟机。 因此可以方便将现有的[去中心化应用](https://learnblockchain.cn/tags/DApp)移植到乐观 Rollup 或使用以太坊开发工具创建新的去中心化应用程序。



