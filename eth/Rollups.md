# Rollups

## 什么是Rollups？

Rollups是基于Layer 2的扩容技术，L2 Rollup指许多与以太坊主网平行运行但同时继承以太坊本身的可用性和完整性的第三方扩容方案，它允许交易在一个并行单独的区块链上执行。

Rollups的扩容原理是将数百个已处理的交易汇总成一个批次，并在与以太坊主网平行的L2链上按批次执行交易，最终完成的交易再按批次一次性发布到底层（Layer 1）区块链，以此来提升交易速度，降低交易燃料费。

Rollups主要有两个方案：Op Rollup和ZK Rollup。他们执行原理差不多，主要区别在于交易验证过程。

## Op Rollup

Op Rollup全称为Optimistic Rollup。Optimistic扩容方案是基于“乐观”机制的，采用的是**欺诈证明**（Fraud proofs），即系统乐观的相信交易数据的正确性，数据不经过有效验证，但会直接进入一个等待期，等待期里如果有任何节点提出异议并佐证恶意交易，则交易取消；若无异议，等待期结束，交易自动完成并写入区块。这种“欺诈证明”方案不需要在每笔交易中部署验证，大大节省了网络计算资源跟成本，同时也保证了及时的最终确定性。

Op Rollup比较突出的两个方案是**Arbitrum**和**Optimism**。这两个方案在结构上差不多，关键区别在于他们的防欺诈逻辑，以及未来处理兼容性问题的方式上也略有差异。

### Optimism

**Optimism采用的是单轮非交互式欺诈证明**。L2 验证人将压缩后的数据同步到 L1 ，同时质押保证金，如果有人对该Rollup区块的交易数据存在争议，则需发起挑战且同样质押保证金。然后Rollup协议将在L1链上重新计算该区块中所有交易来判定对错。错误方的保证金将被罚没，正确方将获得奖励。

这个方案的优点在于：只需进行一轮交互，它在设计上要简单得多，并消除了有关各方之间协调的需要，使欺诈证明瞬间完成，所需时间更短。

缺点是：虽然相对于以太坊主链的成本要少很多，但是相对于交互式最终的单一性计算，其链上计算的成本要更高，甚至如果需要重新计算的交易过多，可能还会受到 L1 区块大小（gas limit）的限制。

### Arbitrum

**Arbitrum采用多轮交互型欺诈证明**。L2的验证人将压缩后的数据同步到L1，同时质押保证金，如果有人对该 Rollup区块的交易数据存在争议，则需发起挑战且同样质押保证金。验证人和挑战者在链下通过二分法的方式不断拆分存在争议的步骤，直至将争议范围缩减到一个具体的步骤，再到L1链上对该步骤进行判定，以此高效解决争议。

这种方式的优点：因为只验证单步，不面临这种限制：gas limit限制，并且能以较低的成本在链上解决争议。采用多轮交互型设计也使 Arbitrum 可以更容易支持复杂的智能合约，在复杂的以太坊生态应用中互操作性更高。

多轮交互型设计的相对缺点：由于增加了交互次数，对应的争议窗口设计相较于单轮交互型设计也更长更复杂，并且交互式欺诈证明需要多方合作来剖析挑战，需要更长的时间来解决。

## ZK Rollup

**零知识证明**（Zero-Knowledge Proof，ZKPs）是一种证明方法，通过这种方法，一方（证明者）可以在不透露任何实际信息的情况下，向另一方（验证者）证明它知道一个秘密或一个声明是真实的。这个概念在1980年被麻省理工学院的研究人员引入，人们一直认为 ZKPs 过于复杂，幽默地称其为“月亮数学”。

ZK Rollup 即通过零知识有效性证明的扩容方案。ZK Rollup分批处理链下交易，并生成加密有效性证明来验证每批交易的真实性。有效性证明将批量交易添加到 L1 区块链。当交易批次被提交时，该证明可以被L1合约快速验证，无效的批次可以被直接拒绝。

### Loopring

Loopring是基于以太坊区块链的去中心化交易所（DEX）的第二层扩展协议，每秒可以处理数千笔交易的结算。Loopring技术可作为协议层在DEX中使用，该平台还提供Loopring Exchange，这是一个非托管交易平台，可提供安全、高速的交易，且不收任何燃料费。

Loopring利用零知识证明允许构建高吞吐量、非托管的去中心化交易所。Loopring还使用了其原生LCR代币奖励零知识卷叠运营商和流动性提供者。

### Aztec

Aztec是L2中的一个项目，其实现了隐私交易。其体系为：基于底层的PLONK证明系统，实现账目间的匿名交易，并通过网关合约的嫁接来实现和DeFi项目的隐私交互。

在Aztec的数据结构中所有票据的状态存储在两个Merkle Trees中，其中一个是**note tree**（票据树），存储着所有生成过的票据，另一个则是**nullifier tree**（废弃树），存储所有被销毁过的票据。所谓“拥有”一张票据，即在 note tree 中存在对应票据、而在nullifier tree中不存在对应票据。

当用户要进行一笔交易时，需销毁并生成相应的票据，再将票据所有权转移。而对于这笔私密交易，用户需要在本地生成一个“隐私证明”。随后，28笔私密交易将会聚合为内部Rollup证明，之后又有32个这样的内部Rollup证明聚合为外部Rollup证明。外部Rollup证明将会最终被提交到L1上，供节点验证。也就是说，一个最终提交的Rollup证明中可以包含28*32=896笔交易。



Aztec的优势在于：其实现了安全级别较高、且能够和DeFi项目交互的隐私功能。

然而特殊的隐私功能也很大程度上限制了项目：一方面Aztec依靠集成网关合约来实现对 DeFi项目的操作，在降低部署难度的同时也降低了灵活性，短期来看更适合操作单一、资本密集的项目；另一方面，为了实现隐私，要求给每一笔交易都生成隐私证明，虽然项目通过双层Rollup方式分摊了存储空间，但 Aztec 的手续费在所有 L2 中仍然是最高的，对用户而言门槛也较高，更适合大户。

### Hermez

Hermez是一个基于ZK技术的去中心化L2 Rollup解决方案。

Hermez有两个版本：1.0是一个支付平台，目前正在运行；2.0正在开发，将把完全兼容的 zkEVM 带到以太坊。

#### Hermez 1.0

Hermez以ZK Rollup开局，专注于扩展以太坊上的支付和代币转移。简单来说，就是将一批交易放在链外执行。

Rollups 使用以太坊进行数据存储而非计算。Rollup 不是在以太坊上把交易一个个地依次地执行，而是把一批交易（包含成千上万个交易）在链外一次性执行。

当这些成千上万的交易在链外被执行时，在 Hermez 的情况下，会产生一个 ZK-SNARK proof，用来证明在链外执行的成千上万的交易是正确的。SNARK proof 证明了该批交易的有效性，这意味着不需要以太坊验证每一笔交易，只需以太坊验证证明。